# Saffron 3 - Formats

This document describes the formats used and generated by Saffron 3.
All formats are in JSON and we will describe the properties each file has, with a link to an example (as found in the [examples](https://gitlab.insight-centre.org/saffron/saffron/blob/saffron_development/examples/) folder)

## Input formats
### Corpus  (e.g. [input_corpus.json](https://gitlab.insight-centre.org/saffron/saffron/blob/saffron_development/examples/input_corpus.json) and [input_corpus2.json](https://gitlab.insight-centre.org/saffron/saffron/blob/saffron_development/examples/input_corpus2.json))

This file contains the description of the corpus, including all the metadata. It is a collection of documents, each entry being a different document with its own metadata and link to the file containing the text. A corpus has the following properties:

* `documents`: A list of documents in the corpus. Each document of the list should have *at least* one of the following four:
    * `file`: A string referring to the original version of this document on disk (absolute or relative path) (see [input_corpus.json](https://gitlab.insight-centre.org/saffron/saffron/blob/saffron_development/examples/input_corpus.json)).
    * `id`: A unique string to identify the document
    * `url`: The URL of the file
    * `contents`:  The text contents of the file (see [input_corpus2.json](https://gitlab.insight-centre.org/saffron/saffron/blob/saffron_development/examples/input_corpus2.json))

    In addition the following attributes may be provided:
    * `name`: The human readable name of the document
    * `mime_type`: The MIME type of the document
    * `authors`: An array of authors of this document



            
        For each author of the document, provide:
        - Either the name of the author as a string
        - Or if more details on the author:
            * `name`: The author's name (required)
            * `id`: A unique string to identify the author (optional)
            * `name_variants`: An array of strings given other known variants of the name (optional)
            
    * `metadata`: An object containing any other properties. Each property is in the form: 
        ```"property name":"property value"```, separated by commas


### Config ([config.json](https://gitlab.insight-centre.org/saffron/saffron/blob/saffron_development/examples/config.json))

This input file for the command line interface (generated automatically if using the user interface) describes all options from the different steps of Saffron.
See the [wiki](https://gitlab.insight-centre.org/saffron/saffron/wikis/saffron-approach) for the details on what each property is for and the scientific explaination of the method. The config file contains each of the Saffron steps:

#### 1.   Term Extraction
Configuration for the options of the term extraction phase. All properties are included under the object:
* `termExtraction`: This element contains the following properties to set up:
    * `threshold`: Sets a minimum Saffron score for the terms retrieved.
    * `maxTerms`: Sets the maximum number of terms to extract. The default is 100.
    * `ngramMin`: Sets the shortest length of term to consider (in terms of the number of words). The default is 1.
    * `ngramMax`: Sets the longest length of term to consider (in terms of number of words). The default is 4.
    * `minTermFreq`: Sets the number of times a term must appear in the dataset to be retrieved. The default is 2.
    * `maxDocs`: The maximum number of documents to consider for the analysis. The default is 2147483647.
    * `method`: Choose between two ranking procedures: "voting" (An algorithm that integrates multiple score functions) and "single" (only one score function).
    * `features` : List of scoring functions if the "voting" method above was selected, or will be ignored if the "single" method was chosen. The default set of features is ([ "comboBasic", "weirdness", "totalTfIdf", "cValue", "residualIdf" ]).
        *  The features include:  `comboBasic`, `weirdness`, `totalTfIdf`, `cValue`, `residualIdf`, `avgTermFreq`, `basic`, `novelTopicModel`, `postRankDC`, `relevance`
    * `corpus`:  #deprecated (by default set to ${saffron.home}/models/wiki-terms.json.gz).
    * `baseFeature`: If `method` is set to "single", a unique scoring function shall be selected as a base. If `method` is set to "voting", choose the scoring function that will get more weight in the calculation of the final score. (Choose between the options given above in `features`).
    * `numThreads` : #deprecated (The default was 0).
    * `posModel`: The path to the part-of-speech tagger model. Only models from [OpenNLP](http://opennlp.sourceforge.net/models-1.5/) are currenlty supported. The default model is set to ("${saffron.home}/models/en-pos-maxent.bin").
    * `tokenizerModel`: The path to the tokenizer model. Only models from [OpenNLP](http://opennlp.sourceforge.net/models-1.5/) are currenlty supported. The default is set to "null" (the configuration will automatically use the one English tokenizer that is provided by OpenNLP).
    * `lemmatizerModel`: The path to the lemmatizer model. Only models from [OpenNLP](http://opennlp.sourceforge.net/models-1.5/) are currenlty supported.  The default is set to ("${saffron.home}/models/en-lemmatizer.dict.txt").
    * `stopWords`: The path to the list of stop words (one per line) if different from the [default stopwords file](https://gitlab.insight-centre.org/saffron/saffron/blob/saffron_development/taxonomy/src/main/resources/stopwords/README).
    * `preceedingTokens`: The set of tags allowed in non-final position in a noun phrase. The default tagset is ["NN", "JJ", "NNP", "NNS"].
    * `middleTokens`: The set of tags allowed in non-final position, but not completing. The default tag is set to ["IN"].
    * `headTokens`: The set of final tags allows in a noun phrase. The default is set to ["NN", "CD", "NNS"].
    * `headTokenFinal`: The position of the head of a noun phrase. Default value is set to "true" which means "final". 
    * `blacklist` : A list of terms that should never be generated. The default is an empty list.
    * `blacklistFile`: The path to a file containing a list of terms that should never be generated (one term per line). Null is the default value.
    * `oneTopicPerDoc`: If set, always output at least one topic for each input document (overrides maxTerms if necessary). The default value is false.
   

#### 2.   Author - Term Linking
The phase of linking between authors and terms (Only if authors are present in the metadata, ignored otherwise).
* `authorTerm`: An element which contains the following property to set up:
    * `topN`: The maximum number of total author-term pairs to extract. The default is 1000.

#### 3.   Author Similarity
The phase of connecting authors with similar areas of expertise together (Only if authors are present in the metadata, ignored otherwise).

* `authorSim`:  An element which contains the following properties to set up:
    * `threshold`: The minimum threshold of similarity to accept. The default is set to 0.1.
    * `topN`: The maximum number of similar authors (per author) to extract. The default number is set to 50.


#### 4.   Term Similarity
The phase of connecting similar terms.
* `termSim`: An element contains the following properties to set up:
    * `threshold`: The minimum threshold for accepting similarity between two terms. The default threshold is 0.1.
    * `topN`: The maximum number of terms to accept. The default is set to 50 terms.


#### 5.   Taxonomy Extraction


* `taxonomy`:  Taxonomy extraction with Pairwise Scoring model training. It contains the following properties to set up:

    ##### 5.1   Taxonomy extraction with Pairwise Scoring model training 
    The phase of supervised taxonomy extraction - ***Command Line Interface Only***

    * `negSampling`: The number of negative samples to generate when training. The default number is set to 5.0 negative samples -  *only used for training the Pairwise Scoring model*
    * `features` : The features to use, each of them can be set to "false" or "true", with default to "false" (see example below). The default for the overall "features" property is set to null.
    
            
            "features": {
                "gloveFile": "/home/.../ GloVe-1.2.zip",
                "hypernyms": "/.../.../XYZ.txt",
                "featureSelection": {
                    "inclusion": true,
                    "overlap": true,
                    ... }
                }
        * `gloveFile`: The file containing the GloVe vectors or null if not used.
        * `hypernyms`: The file containin the hypernyms.
        * `featureSelection`:  The feature selection (or null for all features). Each of them can be set to "false" or "true", with default to "false". The default for the overall "featureSelection" property is set to null. For more information on the implementation of these features see [Features.java](https://gitlab.insight-centre.org/saffron/saffron/blob/saffron_development/taxonomy/src/main/java/org/insightcentre/nlp/saffron/taxonomy/supervised/Features.java) ***Command Line Interface Only***. Choose between the following features:
            * `inclusion`: uses the inclusion feature: a string is said to include another string if it starts or ends with that string respecting word boundaries.
            * `overlap`: uses the overlap feature, ie. the number of words that are in both strings divided by the length of the top string in the pair.
            * `lcs`: uses the longest common subsequence feature, is. the longest common subsequence of words divided by the length of top string in the pair.
            * `svdSimAve`: uses the SVD Average Vector Similarity feature. Get the similarity of these vectors by using an inverse learned relation over average vectors.
            * `svdSimMinMax`: uses the SVD Minimum-Maximum Vector Similarity feature. Get the similarity of these vectors by using an inverse learned relation over min-max vectors.
            * `topicDiff`: uses the Topic Difference feature: document topic complement difference which is defined as |A n B| / |A| - |A n B| / |B|
            * `relFreq`: uses the relative frequency feature, ie. the relative frequency of the terms given as log(freq(top)/freq(bottom))
            * `wnDirect`: uses direct wordnet
            * `wnIndirect`: uses indirect wordnet
    * `modelFile`: The model to be trained. The default model is set to "${saffron.home}/models/default.json"
    * `maxChildren`: #deprecated
    * `simThreshold`: #deprecated


   ##### 5.2.   Taxonomy Search
    The phase of search in the taxonomy algorithm that connects the terms together in order to build the taxonomy.
    
    * `search`:  An element which contains the following properties to set up:
        * `algorithm`: The algorithm to use for finding a taxonomy. Choose between `greedy`, `beam`, `mst` for Minimum Spanning Tree. The default algorithm is set to `greedy`.
        * `beamSize`:  The size of the beam to use in the beam search (only if Beam search is chosen, ignored otherwise). The default beam size is 20.
        * `score`: The scoring function to optimize. Choose between `simple`, `transitive`, `bhattacharryaPoisson`. The default scoring function is `simple`.
        * `baseScore`: The base metric for Bhattacharrya-Poisson (BP) (only if BP search is chosen, ignored otherwise). The default is set to `simple`
        * `aveChildren`: The average number of children (only if BP search is chosen, ignored otherwise). The default average is set to 3.0 children.
        * `alpha`: The weighting to give to the BP (against the base algorithm) - (only if BP search is chosen, ignored otherwise). The default value is 0.01.


## Ouput formats

### Terms ([terms.json](https://gitlab.insight-centre.org/saffron/saffron/blob/saffron_development/examples/output_files/terms.json))

Each element in this file represents a single term extracted from the corpus. The file contains the following annotations:
* `term_string`: The string that names the term (must be unique)
* `occurrences`: The total number of occurrences of a term in the corpus
* `matches`: The number of documents in the corpus containing this term
* `score`: The importance of the term to this corpus (between 0 and 1)
* `status`: Whether the term was validated or not (see the [Review mode](https://gitlab.insight-centre.org/saffron/saffron/wikis/Review-mode) documentation). The default is set to **none**
* `mv_list`: A list of alternative (morphological variants) forms of this 
term string
   * `string`: The form of this variant


### Doc-Terms ([doc-terms.json](https://gitlab.insight-centre.org/saffron/saffron/blob/saffron_development/examples/output_files/doc-terms.json)) 

A file shows all relationships between documents and terms.
* `document_id`: A unique string to identify the document, made up of the document filename (preceded by _zip_filename if the dataset is submitted as a .zip file)  
* `term_string`: The string that names the term (must be unique)
* `occurrences`: The number of occurrences of the term in the single document




### Term-Sim ([term-sim.json](https://gitlab.insight-centre.org/saffron/saffron/blob/saffron_development/examples/output_files/term-sim.json))

This file gathers and compares all pair of terms extracted in the previous stage. Each element describes one edge, ie. a relation between two terms, and their similarity score (see the [pairwise scoring](https://gitlab.insight-centre.org/saffron/saffron/wikis/saffron-approach#211-pairwise-scoring) step for more explanation on how this is calculated).
* `term1_id`: The first term's term string
* `term2_id`: The second term's term string
* `similarity`: The similarity of the two terms 
* `status`: #deprecated



<!--Whether the relation was validated or not during the Review mode (see the [Review mode](https://gitlab.insight-centre.org/saffron/saffron/wikis/Review-mode) documentation). Default to **none** -->

### Taxonomy ([taxonomy.json](https://gitlab.insight-centre.org/saffron/saffron/blob/saffron_development/examples/output_files/taxonomy.json))

This file represents the whole taxonomy. Each element describes a term and how it is related to other terms in the taxonomy. The file contains the following attributes:
* `root`: The term string of this term or "HEAD_TERM" for the root of the taxonomy
* `score`: The weighting given to the root term
* `linkScore`: The likelihood of the link from this term to its root being correct
* `children`: A list of children of this node (these are also Taxonomy objects)
* `status`: #deprecated
* `parent`: #deprecated




*If authors are present in the original corpus as metadata. The following files will be generated*

### Author-Terms ([authors-terms.json](https://gitlab.insight-centre.org/saffron/saffron/blob/saffron_development/examples/output_files/author-terms.json))
An edge linking an author to a term
* `author_id`: The ID of the author
* `term_id`: The term string of the term
* `matches`: The number of times this term is used in documents by this author
* `occurrences`: The number of occurrences of the term by this author
* `paper_count`: The number of documents from the author containing this term
* `tfidf`: The Term Frequency-Inverse Research Frequency (See "Domain adaptive 
extraction of topical hierarchies for Expertise Mining" (Georgeta Bordea (2013)) 
for evaluations of different methods)
* `score`: The score of this linking
* `researcher_score`: The score for author's ranking for this particular term



### Author-Sim ([author-sim.json](https://gitlab.insight-centre.org/saffron/saffron/blob/saffron_development/examples/output_files/author-sim.json))
An edge linking authors together
* `author1_id`: The ID of the first author
* `author2_id`: The ID of the second author
* `similarity`: The similarity score between these authors



$$
M = \left( \begin{array}{ccc}
x_{11} & x_{12} & \ldots \\
x_{21} & x_{22} & \ldots \\
\vdots & \vdots & \ldots \\
\end{array} \right)
$$